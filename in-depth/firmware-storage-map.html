<!DOCTYPE html>

<html lang="en" class="without-js">
<head>
  <title>Firmware storage map | Tow-Boot</title>
  <base href=".." />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0" />
  <link rel="stylesheet" href="styles/index.css" type="text/css" />
  <link rel="shortcut icon" type="image/png" href="favicon.png" />
  <meta property="og:image" content="logo/opengraph-image.png" />
  <script>
    var html = document.documentElement;
    html.className = html.className.replace("without-js", "with-js");
  </script>
</head>

<body>
  <header>
    <div>
      <h1><a href="./">Tow-Boot</a></h1>
      <nav>
        <ul>
          <li><a href="FAQ.html">FAQ</a></li>
          <li><a href="getting-started.html">Getting Started</a></li>
          <li><a href="devices/index.html">Devices</a></li>
          <li><a href="https://github.com/Tow-Boot/Tow-Boot/releases">Releases</a></li>
          <li><a href="https://github.com/Tow-Boot/Tow-Boot/">Code</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <div class="generic-layout">

<h1>Firmware storage map</h1>
<p>This document serves to show where things are written to on the different
backing storage media.</p>
<blockquote>
<p><strong>NOTE</strong>: While this documents environment with shared storage media, it is
not currently supported by any platforms. Though the allowances are put in
place to ensure we can in the future.</p>
</blockquote>
<h2>Overview</h2>
<p>Tow-Boot is intended to be installed to either a dedicated storage media (e.g.
SPI Flash) or as a discrete partition within the shared media.</p>
<p>In either case, the more than strictly the firmware is stored.</p>
<p>The following map serves to represent on most platforms*. The exact details
of the map, the size, and where it is stored will differ, but the general
idea is the same.</p>
<blockquote>
<p>*: Some platforms, e.g. the Raspberry Pi family of hardware, does not follow
this convention.</p>
</blockquote>
<pre><code>|             \\             |      //      |      896 KiB      | 128 KiB |
|-------------//-------------|      \\      | &lt;unused reserved&gt; |   env   |
|             \\             |      //      |----------- 1 MiB -----------|
| ( Platform-specific span ) |  ( Unused )  |    ( Tow-Boot specific)     |
</code></pre>
<p>This is a simplified overview.</p>
<p>The <strong>Platform-specific span</strong> holds the firmware as loaded by the platform's
Boot ROM. With most platforms, this is a specially formatted header, maybe
some platform-specific firmware files, which serves to load the SPL, which
in turn loads the trustzone implementation, then going back to the SPL,
which finally loads the actual firmware.</p>
<p>In other words, the <em>Platform-specific span</em> generally holds the entire
firmware implementation.</p>
<p>Next is an <strong>Unused</strong> span. This takes the <em>remainder</em> of the space. This
space is <em>currently unused</em>, but expect the firmware code to grow and use that
space.</p>
<p>Finally, the <strong>Tow-Boot specific</strong> span. This span is <em>reserved</em> for Tow-Boot
use. It is found at the very end of the firmware storage media (or the
partition). This span is further divided. 896KiB have been set aside in case
it is ever needed. 128 KiB is then used to hold the environment.</p>
<p>Nothing is set in stone. If a platform requires to encroach on the unused
reserved space, we will change things.</p>
<h3>Rockchip (MMC)</h3>
<p>On Rockchip platform, using the shared boot media (installed to SD or eMMC),
the map for the <em>Platform-specific span</em> looks like the following:</p>
<pre><code>LBA : 0x00  \\  0x22  //  0x40         // 0x4000           \\ 0x5840         0x6040
       |----//---|----\\---|-----------\\--|---------------//--|--------------|
       | [ GPT ] | (empty) | idbloader //  | firmware.itb  \\  |  (reserved)  |
       |    \\   |    //   | ============ Firmware partition ================ |
</code></pre>
<p>The partition is 12MiB. Though most of what is found before <code>0x4000</code> is mostly
wasted space currently.</p>
<p>The reserved span looks like this:</p>
<pre><code>byte: 0xb08000            0xbe8000  0xc08000
LBA : 0x5840              0x5f40    0x6040
       |-----------------------------|
       |      896 KiB      | 128 KiB |
       | &lt;unused reserved&gt; |   env   |
       |----------- 1 MiB -----------|
       |    ( Tow-Boot specific)     |
</code></pre>
<p>The environment is found in <code>0xbe8000</code> up to and excluding <code>0xc08000</code></p>
<h2>Minimum requirements</h2>
<p>While the firmware is currently smaller than that, the minimum requirement is
<strong>4 MiB</strong>. This is the size used by the discrete protective partition. This
means that there is up to 3 MiB reserved for Tow-Boot and</p>
<p>Installation on SPI Flash bigger is, obviously, supported. In those cases the
environment is still at the very end of the storage media.</p>

    </div>
  </main>

  <footer>
    <div>
      <nav>
        <ul>
          <li><a href="sitemap.html">Sitemap</a></li>
        </ul>
      </nav>
    </div>
  </footer>
</body>
</html>
